<html lang="en-GB">
  <head>
    <title>Passengers dropdown test</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico" />
    <link rel="stylesheet" href="global.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script defer src="./scripts/passengers.js"></script>
    <style>
      form {
        border: 2px solid;
        margin-top: 2rem;
        padding: 1rem 20px;
      }

      /* From 960px and up, make the form horizontal */
      @media screen and (min-width: 60em) {
        form {
          align-items: center;
          display: flex;
          gap: 20px;
        }

        form > .field + .field {
          margin-top: 0;
        }
      }

      .field--passengers {
        position: relative;
      }

      [inputmode="numeric"] {
        all: initial;
        border: 1px solid transparent;
        padding: 1rem;
        text-align: center;
        width: 1em;
      }

      [inputmode="numeric"]:focus {
        border-color: currentColor;
        outline: 2px solid var(--color-highlight);
      }

      .passengers-dropdown {
        background: white;
        border: 2px solid currentColor;
        color: black;
        inset-inline-start: 0;
        overflow: auto;
        padding: 1rem;
        position: absolute;
        top: calc(100% - 2px);
        width: min(30em, 60em);
      }

      .passengers-dropdown ul {
        list-style: none;
        margin: 0;
        padding: 0;
      }

      .passengers-dropdown li {
        align-items: center;
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
      }

      .passengers-dropdown li span span {
        color: var(--color-body-text-light);
        display: block;
        font-size: 0.9em;
      }

      .passengers-dropdown small {
        flex: none;
        width: 100%;
      }

      .toggle {
        -webkit-appearance: none;
        appearance: none;
        -webkit-tap-highlight-color: transparent;
        cursor: pointer;
        height: 32px;
        width: 52px;
        border-radius: 16px;
        display: inline-block;
        position: relative;
        margin: 0;
        border: 2px solid #474755;
        background: linear-gradient(180deg, #2d2f39 0%, #1f2027 100%);
        transition: all 0.2s ease;
      }

      .toggle:focus-visible {
        outline: 2px solid var(--color-highlight);
        outline-offset: 1px;
      }

      .toggle::after {
        content: "";
        position: absolute;
        top: 2px;
        left: 2px;
        width: 24px;
        height: 24px;
        border-radius: 50%;
        background: white;
        box-shadow: 0 1px 2px rgba(44, 44, 44, 0.2);
      }

      .toggle:checked::after {
        transform: translatex(20px);
      }

      .error {
        background-color: #fbe0dd;
        border: 1px solid #d73e2c;
        color: #191919;
        margin-top: 20px;
        padding: 0.5rem;
        width: 100%;
      }

      [data-js-decrease],
      [data-js-increase] {
        border-radius: 50%;
      }
    </style>
  </head>
  <body>
    <header>
      <a href="./"><abbr title="accessibility">a11y</abbr> tests</a>
    </header>
    <main id="main">
      <h1>Passengers dropdown test</h1>
      <p>
        The user needs to be able to select the number and type of passengers
        for their booking.
      </p>
      <form action="" method="get">
        <div class="field field--passengers">
          <button
            aria-controls="passengers-dropdown"
            aria-expanded="false"
            aria-live="polite"
            class="input"
            id="passengers-button"
            type="button"
          >
            Passengers
          </button>
          <!--
            The dropdown contains multiple lists:
            The `hidden` attribute is like `display:none` so it makes it hidden from search engines but
            if you want to animate this component in, you'll need `aria-hidden="true"` alongside your CSS.
          -->
          <div class="passengers-dropdown" hidden id="passengers-dropdown">
            <ul>
              <li class="field">
                <span id="passengers-label-adult"
                  >Adult
                  <span>(26+ years)</span>
                </span>
                <div data-js-number>
                  <button
                    aria-describedby="passengers-label-adult"
                    aria-label="Decrease number by 1"
                    data-js-decrease
                    type="button"
                  >
                    -
                  </button>
                  <input
                    aria-describedby="passengers-label-adult error-adult-1 error-adult-2"
                    aria-live="polite"
                    inputmode="numeric"
                    name="adult"
                    type="text"
                    value="0"
                  />
                  <button
                    aria-describedby="passengers-label-adult"
                    aria-label="Increase number by 1"
                    data-js-increase
                    type="button"
                  >
                    +
                  </button>
                </div>
                <div class="error" id="error-adult-1">
                  There must be at least one adult, youth or senior per booking.
                </div>
                <div class="error" id="error-adult-2">
                  To book for 10 or more people, please use our group booking
                  form.
                </div>
              </li>
              <li class="field">
                <span id="passengers-label-youth">
                  Youth <span>(12-25 years)</span>
                </span>
                <div>
                  <button
                    aria-describedby="passengers-label-youth"
                    aria-label="Decrease number by 1"
                    data-js-decrease
                    type="button"
                  >
                    -
                  </button>
                  <input
                    aria-describedby="passengers-label-youth"
                    aria-live="polite"
                    inputmode="numeric"
                    name="youth"
                    type="text"
                    value="0"
                  />
                  <button
                    aria-describedby="passengers-label-youth"
                    aria-label="Increase number by 1"
                    data-js-increase
                    type="button"
                  >
                    +
                  </button>
                </div>
              </li>
              <li class="field">
                <span id="passengers-label-child">
                  Child <span>(0-11 years)</span></span
                >
                <div>
                  <button
                    aria-describedby="passengers-label-child"
                    aria-label="Decrease number by 1"
                    data-js-decrease
                    type="button"
                  >
                    -
                  </button>
                  <input
                    aria-describedby="passengers-label-child passengers-hint-child"
                    aria-live="polite"
                    inputmode="numeric"
                    name="child"
                    type="text"
                    value="0"
                  />
                  <button
                    aria-describedby="passengers-label-child"
                    aria-label="Increase number by 1"
                    data-js-increase
                    type="button"
                  >
                    +
                  </button>
                </div>

                <small id="passengers-hint-child">
                  Children receive up to 30% off our standard fares. Please
                  check the price summary when choosing your ticket.
                </small>
              </li>
              <li class="field">
                <span
                  aria-describedby="passengers-hint-infant"
                  id="passengers-label-infant"
                >
                  Infant
                  <span>(0-3 years) (free on lap)</span>
                </span>
                <div>
                  <button
                    aria-describedby="passengers-label-infant"
                    aria-label="Decrease number by 1"
                    data-js-decrease
                    type="button"
                  >
                    -
                  </button>
                  <input
                    aria-describedby="passengers-label-infant"
                    aria-live="polite"
                    inputmode="numeric"
                    name="infant"
                    type="text"
                    value="0"
                  />
                  <button
                    aria-describedby="passengers-label-infant"
                    aria-label="Increase number by 1"
                    data-js-increase
                    type="button"
                  >
                    +
                  </button>
                </div>
                <small id="passengers-hint-infant">
                  Infants can travel for free on an adult's lap and just need a
                  passport. You can only take one infant per adult.
                </small>
              </li>
              <li class="field">
                <label for="thalys">Thalys pass</label>
                <input
                  class="toggle"
                  id="thalys"
                  name="thalys"
                  type="checkbox"
                  value="true"
                />
              </li>
              <li class="field">
                <label for="wheelchair">Wheelchair user</label>
                <input
                  class="toggle"
                  id="wheelchair"
                  name="wheelchair"
                  type="checkbox"
                  value="true"
                />
              </li>
            </ul>
            <div class="field field--buttons">
              <button class="button button--full-width" type="button">
                Ok
              </button>
            </div>
          </div>
          <div
            class="passengers-dropdown"
            hidden
            id="passengers-wheelchair-dropdown"
          >
            <ul>
              <li class="field">
                <span id="passengers-label-adult">
                  Adult (26+ years)
                  <span>in wheelchair</span>
                </span>
                <div data-js-number>
                  <button
                    aria-describedby="passengers-label-adult"
                    aria-label="Decrease number by 1"
                    data-js-decrease
                    type="button"
                  >
                    -
                  </button>
                  <input
                    aria-describedby="passengers-label-adult"
                    aria-live="polite"
                    inputmode="numeric"
                    name="adult"
                    type="text"
                    value="0"
                  />
                  <button
                    aria-describedby="passengers-label-adult"
                    aria-label="Increase number by 1"
                    data-js-increase
                    type="button"
                  >
                    +
                  </button>
                </div>
              </li>
              <li class="field">
                <span id="passengers-label-youth">
                  Youth (12-25 years)
                  <span>in wheelchair</span>
                </span>
                <div>
                  <button
                    aria-describedby="passengers-label-youth"
                    aria-label="Decrease number by 1"
                    data-js-decrease
                    type="button"
                  >
                    -
                  </button>
                  <input
                    aria-describedby="passengers-label-youth"
                    aria-live="polite"
                    inputmode="numeric"
                    name="youth"
                    type="text"
                    value="0"
                  />
                  <button
                    aria-describedby="passengers-label-youth"
                    aria-label="Increase number by 1"
                    data-js-increase
                    type="button"
                  >
                    +
                  </button>
                </div>
              </li>
              <li class="field">
                <span id="passengers-label-child">
                  Child (0-11 years)
                  <span>in wheelchair</span>
                </span>
                <div>
                  <button
                    aria-describedby="passengers-label-youth"
                    aria-label="Decrease number by 1"
                    data-js-decrease
                    type="button"
                  >
                    -
                  </button>
                  <input
                    aria-describedby="passengers-label-youth"
                    aria-live="polite"
                    inputmode="numeric"
                    name="child"
                    type="text"
                    value="0"
                  />
                  <button
                    aria-describedby="passengers-label-youth"
                    aria-label="Increase number by 1"
                    data-js-increase
                    type="button"
                  >
                    +
                  </button>
                </div>
                <small id="passengers-hint-child-companion">
                  Children must travel with a companion that is 16 years or
                  older.
                </small>
              </li>
              <li class="field">
                <span
                  aria-describedby="passengers-hint-companion"
                  id="passengers-label-companion"
                >
                  Companion
                  <span>(concession fare)</span>
                </span>
                <div>
                  <button
                    aria-describedby="passengers-label-companion"
                    aria-label="Decrease number by 1"
                    data-js-decrease
                    type="button"
                  >
                    -
                  </button>
                  <input
                    aria-describedby="passengers-label-companion"
                    aria-live="polite"
                    inputmode="numeric"
                    name="companion"
                    type="text"
                    value="0"
                  />
                  <button
                    aria-describedby="passengers-label-companion"
                    aria-label="Increase number by 1"
                    data-js-increase
                    type="button"
                  >
                    +
                  </button>
                </div>
              </li>
              <li class="field">
                <label for="wheelchair">Wheelchair user</label>
                <input
                  aria-describedby="passengers-hint-wheelchair"
                  checked
                  class="toggle"
                  id="wheelchair"
                  name="wheelchair"
                  type="checkbox"
                  value="true"
                />
                <small id="passengers-hint-wheelchair">
                  Each wheelchair user can take one companion.
                </small>
              </li>
            </ul>
            <div class="field">
              <button class="button button--full-width" type="button">
                Ok
              </button>
            </div>
          </div>
        </div>
        <div class="field field--buttons">
          <button type="submit">Search</button>
        </div>
      </form>
    </main>

    <script>
      // @ts-check

      /** @var {HTMLInputElement | null } */
      const button = document.querySelector("#passengers-button");

      /** @var {HTMLDivElement | null } */
      const dropdown = document.querySelector("#passengers-dropdown");

      /** @var {NodeListOf<HTMLInputElement>} */
      const buttonsWheelchair = document.querySelectorAll("#wheelchair");

      /** @var {HTMLDivElement | null } */
      const dropdownWheelchair = document.querySelector(
        "#passengers-wheelchair-dropdown"
      );

      /**
       * Display the dropdown
       *
       * @return {void}
       */
      const showDropdown = () => {
        dropdown?.removeAttribute("hidden");
      };

      /**
       * Hide the dropdown
       *
       * @return {void}
       */
      const hideDropdown = () => {
        dropdown?.setAttribute("hidden", "");
      };

      /**
       * Display the wheelchair dropdown
       *
       * @return {void}
       */
      const showWheelchairDropdown = () => {
        dropdownWheelchair?.removeAttribute("hidden");
      };

      /**
       * Hide the wheelchair dropdown
       *
       * @return {void}
       */
      const hideWheelchairDropdown = () => {
        dropdownWheelchair?.setAttribute("hidden", "");
      };

      /**
       * Show or hide the right dropdown based upon whether the active wheelchair checkbox is checked
       * @param {Event} event
       *
       * @return {void}
       */
      const toggleDropdownType = (event) => {
        if (event.target.checked === true) {
          hideDropdown();
          showWheelchairDropdown();
        } else {
          hideWheelchairDropdown();
          showDropdown();
        }

        // keep the buttons aligned
        buttonsWheelchair.forEach(
          (button) => (button.checked = event.target.checked)
        );
      };

      /**
       * Handle when the user presses a key whilst the button is in focus
       * @param {KeyboardEvent} keyboardEvent
       *
       * @return {void}
       */
      const handleButtonKeyDown = (keyboardEvent) => {
        switch (keyboardEvent.key) {
          default:
            return;
            break;
          case "Escape":
            hideDropdown();
            break;
          case "Enter":
          case " ":
          case "ArrowDown":
            keyboardEvent.preventDefault();
            toggleDropdownType();
            break;
        }
      };

      button?.addEventListener("keydown", handleButtonKeyDown);
      button?.addEventListener("click", toggleDropdownType);

      buttonsWheelchair.forEach((button) =>
        button.addEventListener("change", toggleDropdownType)
      );

      /**
       * Handle when the user presses a key on the document/window
       * @param {KeyboardEvent} keyboardEvent
       *
       * @return {void}
       */
      const handleDocumentKeyDown = (keyboardEvent) => {
        switch (keyboardEvent.key) {
          default:
            return;
            break;
          case "Escape":
            hideDropdown();
            hideWheelchairDropdown();
            break;
        }
      };

      document?.addEventListener("keydown", handleDocumentKeyDown);

      /**
       * Close the dropdown when the user clicks outside of it
       * @param {Event} event
       *
       * @return {void}
       */
      const handleDocumentClick = (event) => {
        if (
          !dropdown.contains(event.target) &&
          button !== event.target &&
          !dropdownWheelchair.contains(event.target)
        ) {
          hideDropdown();
          hideWheelchairDropdown();
        }
      };

      document.addEventListener("click", handleDocumentClick);
    </script>
  </body>
</html>
